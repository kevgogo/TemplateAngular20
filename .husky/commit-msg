echo "🔍 Husky: Validando mensaje de commit..." >&2

# Validación básica sin dependencias externas
MSG_FILE="$1"
MSG_CONTENT="$(cat "$MSG_FILE")"

# Validación simple si commitlint no está disponible
if ! command -v npx >/dev/null 2>&1; then
  echo "⚠️  Node.js no disponible, usando validación básica..." >&2
  
  # Validación básica de longitud
  MSG_LENGTH=$(echo "$MSG_CONTENT" | head -n1 | wc -c)
  if [ "$MSG_LENGTH" -lt 10 ]; then
    echo "❌ El mensaje de commit es demasiado corto (mín. 10 caracteres)" >&2
    exit 1
  fi
  
  if [ "$MSG_LENGTH" -gt 100 ]; then
    echo "❌ El encabezado es demasiado largo (máx. 100 caracteres)" >&2
    exit 1
  fi
  
  echo "✅ Validación básica pasada" >&2
  exit 0
fi

# Usar commitlint con formateador
if npx commitlint --edit "$1" --format ./commitlint.formatter.cjs; then
  echo "✅ Mensaje de commit válido" >&2
else
  echo "❌ Mensaje de commit inválido - revisa el formato" >&2
  exit 1
fi